# [Day 3](http://oj.daimayuan.top/contest/286)

唐。

A 样例挂了，不知道暴力写没写对，不想修成正解。

B 不会。

C 冲了一整场，过了大样例，少判了个东西挂成 $30$。但是 C 好像仍然只有我一个人有分/jy。

### [T1](http://oj.daimayuan.top/contest/286/problem/2863)

弱智大模拟。维护连续段，然后稍微解一下 $\max$ 和 $\min$ 就可以只做 $\mathcal O(1)$ 个时刻的 chkmax。

### [T2](http://oj.daimayuan.top/contest/286/problem/2864)

抽象计数。

考虑差分？可能只是便于思考。给石头剪刀布标上 $012$，差分之后可以发现结构很简单。是不是直接对着他这个东西摁观察也能观察出来啊？

注意到差分之后 $-1$ 位置不变，$1$ 左移一位，如果和 $-1$ 重合就变成 $0$，$0$ 也不变。可以对这个摁 DP。

### [T3](http://oj.daimayuan.top/contest/286/problem/2865)

先考虑 $n=2d-1$ 的部分分。考虑只操作 $n$ 次，随机枚举操作顺序然后高斯消元解一下方程就能得到构造。操作顺序是 $[1,n],[2,n+1]\dots [n,2n-1],[n-1,2n-2]\dots[1,n]$。

对于 $n>2d-1$，可以不断把最后一个修对然后变成 $n-1$ 的问题，最终还是 $n=2d-1$。

对于 $n<2d-1$，中间的部分一定同时被操作，所以也可以只保留一个变成 $n=2d-1$ 的问题。

# [Day 4](http://oj.daimayuan.top/contest/287)

### [T1](http://oj.daimayuan.top/contest/287/problem/2866)

纯傻逼。哈夫曼树高只有 $80$ 左右，随便判一个匹配的东西就行了，但是写丑了导致只有 $80$。

### [T2](http://oj.daimayuan.top/contest/287/problem/2868)

非常套路。首先拆组合意义表示选 $2$ 条边。设 $F_i(x)$ 表示从 $i$ 走到 $fa_i$ 的生成函数，$[x^0]$ 表示没选边，$[x^1]$ 表示选了一条边，$[x^2]$ 表示选了两条边。走过一条边就乘一个 $(1+x)$，转移是 $F(x)=(1+x)(1+\sum(F_{son}(x)+F(x)))/deg$，化简一下就是 $F(x)=\frac{(1+x)(1+\sum F_{son}(x))}{d-(d-1)(1+x)}$，暴力求逆就行了。然后一遍换根可以求出从 $fa_i$ 走到 $i$ 的，然后就做完了。

### [T3](http://oj.daimayuan.top/contest/287/problem/2867)

非常牛的题，再说。

# [Day 5](http://oj.daimayuan.top/contest/288)

### [T1](http://oj.daimayuan.top/contest/288/problem/2882)

难。

$50$ 分是二进制分组，询问次数是 $2\log n$。

给每个点标一个恰好有 $7$ 个 $1$ 的 $14$ 位二进制数，每一位上的 $1$ 向 $0$ 贡献一遍就行了，因为没有子集关系所以是对的。

### [T2](http://oj.daimayuan.top/contest/288/problem/2883)

唐题。

先树剖，考虑编一个标号顺序。到一个点的时候，如果他是链头，就把整条链标上。然后 bfs 遍历距离他小于等于 $3$ 的所有点，给没有标号的标上号，这里 bfs 需要先把重儿子进队，然后再所有轻儿子进队（反过来也行），然后递归做。

性质很好：重链除了最上面三个点连续；子树除了重链和最高三层连续；一个点子树内距离他 $=k(k\leq 3)$ 的所有点，和他不在一条重链上的连续；这样就可以动态维护点权了。

对于一次询问，答案不超过 $3$，然后瞎判一下就行了，需要一个线段树上二分。

### [T3](http://oj.daimayuan.top/contest/288/problem/2884)

$2^nn^2$ 很简单：一行一行的填，可以状压不同等价的列的最后一个字符，每次是一个 $0$ 或 $1$ 变成 $01$ 或 $0$ 或 $1$，要求第一个变的位置必须是 $0$ 变 $1$ 或 $0$ 变 $01$。状态总数是 $2^nn$ 的，转移类似插头 DP 可以做到 $\mathcal O(1)$。最后一个组合数算一下就行了。

正解挺厉害的还是。考虑第一个字符，如果他从 $0$ 变成了 $01$ 或 $1$，则这一行的第二个及之后的字符都是自由的。以这个为阶段 DP。

设 $f_{t,i,j,0/1/01}$ 表示当前有一个长度为 $i$ 的串，经过了 $t$ 次分裂操作之后变成了长度为 $j$ 的，其中第一个字符在第一次操作后变成了 $0/1/01$，并且整体合法的方案数。注意这个定义非常神秘。他的第一行是任意填的，即如果要使用 $f_{*,*,*,1}$ 和 $f_{*,*,*,01}$ 时需要保证第一个字符之前已经合法或者第一个字符是 $0$，使用 $f_{*,*,*,0}$ 时需要保证第一个字符之前已经合法。

首先对于 $f_{t,i,j,1}$，第一个字符从 $0$ 变成 $1$ 的话，第二个及之后的字符可以任意分裂。那就是 $\sum f_{t,i-1,j-1,*}$。

对于 $f_{t,i,j,0}$，第一个字符会在某个时刻从 $0$ 变成 $01$ 或 $1$。枚举时刻 $x$ 以及串在这个时刻的串长 $y$。在这个时刻之前方案数为 $f_{x,i-1,y-1,0/1/01}$，这个时刻之后为 $f_{t-x,y,j,1/01}$。

对于 $f_{t,i,j,01}$，还是考虑第一个字符什么时候发生变化，还是枚举 $x,y$，在这个时刻之前方案数为 $f_{x,i,y,01}$，这个时刻之后为 $f_{t-x,y,j,1/01}$。

初值 $f_{0,i,i,1}=1$。复杂度 $\mathcal O(n^5)$。

# [Day 6](http://oj.daimayuan.top/contest/290)

### [T1](http://oj.daimayuan.top/contest/288/problem/2884)

从后向前直接贪心就是对的。拿个数据结构维护一下就行了。

### [T2](http://oj.daimayuan.top/contest/290/problem/2889)

挺深刻的。

看成是一个链上，要挂若干个点，最小化直径。

类似最小直径生成树的套路，枚举中心所在位置，最小化到他的点的最大值的最小值。如果落在边上是一个单调栈之类的东西。

### [T3](http://oj.daimayuan.top/contest/290/problem/2890)

首先考虑 $AB$ 性质。对于序列的最后一个 $A$，其在操作序列中一定是相邻的 $AC$。把这个东西插到前面的位置里有 $2b-1$ 中方案。归纳，答案是 $(2b-1)!!$。$A$ 性质也是一样的。

太难了，以后再补。

# [day 7](http://oj.daimayuan.top/contest/292)

### [T1](http://oj.daimayuan.top/contest/292/problem/2885)

贡献不大好拆。考虑边分树找边。把所有边权为 $0$ 的并起来之后，剩下的只需要连前驱和后继跑 kruskal 就行了？

一开始写的是 boruvka，但是跑不动啊。kruskal 的正确性不大会证啊。

### [T2](http://oj.daimayuan.top/contest/292/problem/2880)

太变态了这题。

首先如果确定了选哪些菜以及他们的 $a$，可以通过邻项交换证明，按照 $b$ 从大到小排序就是最优的：设有 $(a_1,b_1)$ 和 $(a_2,b_2)$，前者排在前面的条件是 $\max(b_1,a_1+b_2)<\max(b_2,a_2+b_1)$。整理得 $\min(b_2,b_1-a_1)>\min(b_1,b_2-a_2)$。显然等价于 $b_1>b_2$。

然后考虑如果给定了所有的 $a$，要在其中选 $k$ 个的最小代价。就是要最小化 $\max_i(\sum_{j=1}^i a_j+b_i)$。从后向前做，所以按照 $b$ 从小到大排序，$f_{i,j}$ 表示考虑了 $[1,i]$，一共选了 $j$ 个菜，此时的最大值是多少。转移是 $f_{i,j}=\min(f_{i-1,j},\max(f_{i-1,j-1},b_i)+a_i)$。

这个东西看上去不好做，但是如果去掉了 $b$ 他就是凸的，所以其实他是有一些凸的感觉的。考虑算到了 $i$，对于所有 $\leq b_i$ 的 $f$，他以后就永远固定是这个值了，因为第二种转移以后肯定都大于 $b_i$。所以上面的 DP 等价于在做这样一件事：维护一个小根堆，每次加入 $a_i$，不断弹出值。使得弹出的和成为小于等于 $b_i$ 的最大值，**然后把堆顶 $top$ 修改为 $top-(b_i-sum)$，$sum$ 修改为 $b_i$。**

下面的计数感觉想了好久才懂啊。首先暴力就是压下来一整个堆的结构还有记录一下弹出的值的和。设 $f_{i,j,l,r,s}$ 表示考虑了 $i$ 个数，选了 $j$ 个，钦定以后小于 $l$ 的需要加进来，$>r$ 的不能加进来。对于当前的 $b$，如果 $s<b<s+r$，那说明 $r$ 以后没有被加入，修改了之后 $r+s-b$ 没有被加入。

如果 $s-l<b<s$，那说明 $l$ 加入了，即以后的某个时刻 $b-(s-l)$ 加入了，那后面小于 $b-(s-l)$ 的都需要被加入。妈的太神秘了，就这样理解吧。

### [T3]()

# [Day 8](http://oj.daimayuan.top/contest/293)

有傻逼 A 挂了，我不说是谁。

### [T1](http://oj.daimayuan.top/contest/293/problem/2886)

枚举 $y$，选的一定是最小的 $k$ 个 $x$，扫 $y$ 的时候线段树维护即可。

### [T2](http://oj.daimayuan.top/contest/293/problem/2887)

挺唐的感觉。

先判掉不合法。找到区间 $mx$，小于 $mx$ 的数若有 $low$ 个，大于的数有 $up$ 个。

考虑 $low=0$：填相对顺序。$f_{i,j}$ 表示填了 $i$ 个数，当前有 $j$ 个空可以填。可以转移到 $f_{i+1,k\leq j+1}$。画一下：

![image.png](https://s2.loli.net/2025/01/02/lnoideyBUTh4wLm.png)

拉直之后可以看出是格路计数，反射容斥一下可以得到答案是 $\binom{2up}{up}-\binom{2up}{up-1}$。

如果有了 $low$，一旦 $f_{i,j}$ 转移到了 $k\not= j+1$，那 $low$ 就全不能填了。而且 $low$ 内部一定得从小到大填。那枚举 $up$ 一开始走的一个极长链 $i$，方案数是 $(\binom{2up-i}{up}-\binom{2up-i}{up-1-i})\binom{i+low-1}{low-1}$。拆开之后可以组合恒等式 $\mathcal O(1)$ 算。

### [T3](http://oj.daimayuan.top/contest/293/problem/2896)

考虑倒着做。列生成函数：

$$
\begin{aligned}
F_1(x)&=x^B\\
F_i(x)&=F'_{i-1}(x)+xF_{i-1}(x)\\
ans&=[x^A]F_n(x)\\
G_i(x)&=F_i(x)e^{x^2/2}\\
G_1(x)&=x^B e^{x^2/2}\\
G_i'(x)&=F_i'(x)e^{x^2/2}+xF_i(x)e^{x^2/2}\\
        &=G_{i+1}(x)\\
G_n(x)&=(x^Be^{x^2/2})^{(n-1)}\\
F_n(x)&=e^{-x^2/2}(x^Be^{x^2/2})^{(n-1)}\\
\end{aligned}
$$

暴力求就行了。或者有个什么组合意义，就是每次可以选择加球（从小到大的标号加），或者选任意一个球取走。