---
layout: post
title: 2024 集训队互测
subtitle: 做题
show: true
tags: 做题
---

# [Day 1](https://qoj.ac/contest/1808)

### [T1](https://qoj.ac/contest/1808/problem/9463)

感觉能做。

首先考虑给定了一个序列如何判是否合法。如果确定了三种子序列分别的出现次数，暴力 DP 是记录 `A`,`B`,`C`,`AB`,`BC`,`CA` 的出现次数的方案是否合法。

从前向后扫 $s$ 串，如果当前出现了一个字符 `A`，他可以单独成一个新的序列，可以拼到 `C` 上，也可以拼到 `BC` 上。

感性理解就是因为三个串是循环同构的，考虑如果新成一个序列，他后面还要接 `B`,`C`，拼到 `C` 上面还需要接一个 `B`，拼到 `BC` 上面后面就没有限制了。

显然单独成串严格强于拼到 `C` 上严格强于拼到 `BC` 上。因为所有条件最终都需要满足，所以考虑先满足严格的条件一定不劣。理性理解可以通过邻项交换来证明决策包容性。

这样就有贪心：确定了三种子序列的出现次数后，新出现的字符尽量单独成段，其次尽量拼到一个字符上，再次才是拼到两个字符上。设 $x_{0/1/2}$ 表示三种字符当前出现次数，$X_{0/1/2}$ 表示三种字符的上界，可以推出序列合法的充要条件就是保证时时刻刻 $x_i-X_i\leq x_{i+2\bmod 3}$。

一个串可能有多种合法的子序列划分方式。考虑容斥，钦定一些可选方案必须满足。设 $S$ 表示钦定 $x\in S$ 个 `ABC` 需要满足，$T$ 表示钦定 $y\in T$ 个 `BCA` 需要满足，则限制可以变为：

$$
x_0-x_{\min}\leq x_2\\
x_1-y_{\min}\leq x_0\\
x_2-(n-x_{\max}-y_{\max})\leq x_1
$$

容斥系数是 $(-1)^{\lvert S\rvert+\lvert T\rvert}$。容易发现只和 $S,T$ 中的最大，最小值有关。并且考虑对于一对 $x$ 的最小，最大值 $(x,y)$，如果 $x,y$ 中间还有可选方案，则所有 $S$ 的容斥系数之和为 $0$，所以只需要考虑两个相邻的可选方案。选单独一个的容斥系数是 $1$，选相邻两个的容斥系数是 $-1$。对于 $y$ 也同理，这样只需要做 $\mathcal O(n^2)$ 次计算方案数，而计算方案数可以用一个简单的 $\mathcal O(n^3)$ DP 解决。

其实上面的容斥就是点减边，因为合法的取值都是一段区间，但是直接发现是一段区间可能不是那么的明显（可能也比较明显，本身就是关乎最大最小值的限制）。